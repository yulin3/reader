# 漫画阅读器开发需求文档

## 项目概述
开发一个自用的漫画阅读器 SPA 应用，通过扫描本地目录读取漫画文件，提供流畅的阅读体验。

## 技术栈
- **前端框架**：Vue 3（使用 Composition API，`<script setup>` 语法）
- **语言**：TypeScript
- **UI组件库**：Shadcn Vue
- **样式框架**：Tailwind CSS
- **状态管理**：Pinia
- **构建工具**：Vite
- **路由**：Vue Router
- **部署方式**：SPA（单页应用）

## 核心功能需求

### 1. 漫画列表展示页面
- **视图模式**：网格视图
- **显示信息**：
  - 封面图片（使用章节文件夹中的第一张图片）
  - 漫画标题（文件夹名称）
  - 阅读进度标识（如：已读/未读、进度百分比）
  - 最后阅读时间
- **交互功能**：
  - 点击封面进入详情页
  - 无限滚动
  - 加载状态和空状态处理

### 2. 漫画详情页
- **显示内容**：
  - 封面大图展示
  - 漫画标题（文件夹名称）
  - 章节列表（显示所有章节文件夹）
    - 章节名称（文件夹名称）
    - 章节图片数量
    - 阅读状态标识（已读/未读/进行中）
    - 最后阅读位置（如：第 X 页）
- **交互功能**：
  - 点击章节进入阅读器
  - "继续阅读"按钮（跳转到上次阅读位置）

### 3. 阅读器页面
- **核心功能**：
  - 图片展示（单页模式，适应宽度显示）
  - 阅读方向：从左到右
  - 图片排序：按文件名排序
  - 图片预加载：预加载当前图片前后各 10 张
  
- **翻页功能**：
  - 触摸滑动（移动端）左右滑動切換章節 上下滑動加載圖片
  
- **滚动模式**：
  - 垂直滚动阅读长图
  
- **工具栏**：
  - 自动隐藏（阅读时隐藏，鼠标移动/点击时显示）
  - 包含：上一页、下一页、返回、设置、章节切换等按钮
  
- **阅读设置**：
  - 背景色自定义（颜色选择器）
  - 亮度调节（可选）
  - 自动翻页（可选）
  
- **章节导航**：
  - 上一章/下一章切换按钮
  - 章节列表快速跳转

### 4. 阅读进度记录
- **记录内容**：
  - 当前阅读的漫画ID
  - 当前阅读的章节名称
  - 当前阅读的页码（图片文件名或索引）
  - 最后阅读时间
- **存储方式**：使用 localStorage 持久化存储
- **功能实现**：
  - 自动记录阅读位置
  - 在列表页显示阅读进度标识
  - 在详情页显示"继续阅读"按钮
  - 支持从上次位置继续阅读

### 5. 阅读历史记录
- **记录内容**：
  - 最近阅读的漫画列表
  - 最后阅读位置
  - 阅读时间
- **显示位置**：可在列表页或独立页面显示
- **功能**：快速跳转到上次阅读位置

## 数据来源与文件管理

### 文件导入方式

#### Web 端（浏览器）
- **扫描方式**：扫描整个指定目录
- **实现方式**：
  - 使用 File System Access API（Chrome/Edge 支持）
  - 或通过文件选择器让用户选择根目录
  - 递归扫描目录结构

### 文件组织结构
```
根目录/
  ├── 漫画名1/
  │   ├── 章节1/
  │   │   ├── 001.jpg
  │   │   ├── 002.jpg
  │   │   └── ...
  │   ├── 章节2/
  │   │   ├── 001.jpg
  │   │   └── ...
  │   └── ...
  ├── 漫画名2/
  │   └── ...
  └── ...
```

### 元数据获取规则
- **漫画标题**：使用文件夹名称
- **封面图片**：使用每个漫画文件夹中第一个章节的第一张图片
- **章节名称**：使用章节文件夹名称
- **章节图片数量**：统计章节文件夹中的图片文件数量

### 文件格式支持
- **支持的图片格式**：
  - jpg / jpeg
  - png
  - webp
  - gif
  - bmp
  - 其他浏览器原生支持的图片格式

### 图片排序规则
- **排序方式**：按文件名排序（字符串排序）
- **处理方式**：确保文件名格式统一，支持数字补零（如：001.jpg, 002.jpg）

## 设计规范

### 响应式设计
- **移动端优先**：首先设计移动端界面
- **断点设置**：
  - 移动端：< 768px
  - 平板：768px - 1024px
  - 桌面：> 1024px
- **适配要求**：确保在所有设备上都有良好的阅读体验

### 主题系统
- **主题切换**：支持暗色/亮色主题
- **实现方式**：使用 CSS 变量 + Tailwind 的 dark mode
- **自定义背景**：阅读器背景色可自定义（颜色选择器）

### 阅读器界面设计
- **布局**：简洁沉浸式设计
- **工具栏**：自动隐藏（鼠标移动/点击时显示，3-5秒后自动隐藏）
- **背景色**：可自定义，默认深色背景
- **图片显示**：适应宽度，保持图片比例
- **动画**：无翻页动画，直接切换图片

### 性能优化
- **图片加载**：
  - 懒加载：只加载当前可见的图片
  - 预加载：预加载当前图片前后各 10 张
  - 图片缓存：使用浏览器缓存机制
- **虚拟滚动**：列表页如需要可使用虚拟滚动
- **代码分割**：路由级别的代码分割

## 项目结构

```
src/
├── assets/           # 静态资源
├── components/       # 可复用组件
│   ├── ui/          # Shadcn Vue 组件
│   ├── ComicCard.vue
│   ├── ChapterList.vue
│   ├── ReaderToolbar.vue
│   └── ...
├── views/           # 页面组件
│   ├── ListView.vue      # 漫画列表页
│   ├── DetailView.vue    # 漫画详情页
│   └── ReaderView.vue    # 阅读器页面
├── composables/     # 组合式函数
│   ├── useComicScanner.ts    # 扫描漫画文件
│   ├── useReader.ts          # 阅读器逻辑
│   ├── useProgress.ts        # 阅读进度管理
│   ├── useTheme.ts           # 主题切换
│   └── ...
├── stores/          # Pinia 状态管理
│   ├── comic.ts     # 漫画数据状态
│   ├── reader.ts    # 阅读器状态
│   ├── progress.ts  # 阅读进度状态
│   └── settings.ts  # 设置状态
├── types/           # TypeScript 类型定义
│   ├── comic.ts
│   ├── reader.ts
│   └── ...
├── utils/           # 工具函数
│   ├── fileScanner.ts   # 文件扫描工具
│   ├── imageLoader.ts   # 图片加载工具
│   └── storage.ts       # 存储工具
├── router/          # 路由配置
│   └── index.ts
├── App.vue
└── main.ts
```

## 路由结构

```
/                    # 漫画列表页
/detail/:id          # 漫画详情页（id 为漫画文件夹名称或索引）
/reader/:id/:chapter # 阅读器页面
  - id: 漫画标识
  - chapter: 章节名称
  - 可选查询参数：?page=页码
```

## 数据模型

### Comic（漫画）
```typescript
type Comic = {
  id: string              // 唯一标识（文件夹名称）
  title: string           // 标题（文件夹名称）
  cover: string           // 封面图片 URL（第一章节第一张图片）
  chapters: Chapter[]     // 章节列表
  scanTime: number        // 扫描时间戳
}
```

### Chapter（章节）
```typescript
type Chapter = {
  name: string            // 章节名称（文件夹名称）
  path: string           // 章节路径
  images: string[]        // 图片文件路径列表（已排序）
  imageCount: number      // 图片数量
}
```

### ReadingProgress（阅读进度）
```typescript
type ReadingProgress = {
  comicId: string         // 漫画ID
  chapterName: string     // 章节名称
  pageIndex: number       // 当前页码（索引）
  pageName: string        // 当前图片文件名
  lastReadTime: number    // 最后阅读时间戳
}
```

### ReaderSettings（阅读器设置）
```typescript
type ReaderSettings = {
  backgroundColor: string // 背景色（hex）
  brightness: number      // 亮度（0-100）
  autoTurnPage: boolean   // 自动翻页
  autoTurnInterval: number // 自动翻页间隔（秒）
}
```

## 代码规范

### TypeScript 使用
- 使用 TypeScript 编写所有代码
- 优先使用 `type` 而非 `interface`
- 避免使用 `enum`，使用 const 对象代替
- 使用 Vue 3 的 `defineComponent` 和 `PropType`

### Vue 3 规范
- 使用 `<script setup>` 语法
- 使用 Composition API，避免 Options API
- 使用 `ref`、`reactive`、`computed` 进行响应式状态管理
- 使用 `provide/inject` 进行依赖注入（如需要）

### 命名规范
- **目录**：kebab-case（如：`comic-list/`）
- **组件**：PascalCase（如：`ComicCard.vue`）
- **Composables**：camelCase，以 `use` 开头（如：`useComicScanner.ts`）
- **变量/函数**：camelCase
- **常量**：UPPER_SNAKE_CASE

### 代码风格
- 使用箭头函数
- 简洁的条件语句
- 使用模板语法进行声明式渲染
- 避免代码重复，提取可复用逻辑

## 实现细节

### 文件扫描实现
1. 用户选择根目录
2. 递归扫描目录结构
3. 识别漫画文件夹（包含章节子文件夹的文件夹）
4. 扫描每个章节的图片文件
5. 按文件名排序图片
6. 提取封面（第一章节第一张图片）
7. 存储到 Pinia store

### 阅读器实现
1. 加载当前章节的所有图片路径
2. 按文件名排序
3. 显示当前页码的图片
4. 预加载前后各 10 张图片
5. 监听键盘事件和触摸事件
6. 自动记录阅读进度
7. 工具栏自动隐藏逻辑

### 阅读进度实现
1. 监听页码变化
2. 实时更新 localStorage
3. 页面加载时恢复上次阅读位置
4. 在列表页和详情页显示进度标识

### 主题切换实现
1. 使用 Tailwind 的 dark mode
2. CSS 变量定义颜色
3. 用户偏好存储在 localStorage
4. 系统主题检测（可选）

## 错误处理

- 文件读取失败：显示错误提示，允许重试
- 图片加载失败：显示占位符，支持重试
- 存储空间不足：提示用户清理数据
- 浏览器不支持：检测并提示用户使用支持的浏览器

## 平台兼容性

### Web 端（浏览器）
- Chrome/Edge（推荐，支持 File System Access API）
- Firefox（支持文件选择器）
- Safari（iOS 14+，支持文件选择器）
- 移动端浏览器（Chrome Mobile、Safari Mobile 等）
- 需要支持 File System Access API 或文件选择器 API

## 开发优先级

### Phase 1: 核心功能
1. 项目搭建和基础配置（Vue 3 + Vite + TypeScript）
2. 文件扫描功能（Web 端实现）
3. 漫画列表页
4. 漫画详情页
5. 基础阅读器（翻页、缩放）

### Phase 2: 增强功能
1. 阅读进度记录
2. 搜索功能
3. 阅读历史
4. 工具栏自动隐藏
5. 主题切换

### Phase 3: 优化和细节
1. 性能优化（图片缓存、内存管理）
2. 错误处理完善
3. UI/UX 优化
4. 响应式适配（移动端安全区域、手势优化）
5. 背景色自定义
6. 移动端体验优化（触摸手势、全屏模式）

## 注意事项

### 注意事项
1. **隐私和安全**：所有数据存储在本地，不上传到服务器
2. **性能考虑**：大量图片时注意内存管理
3. **文件路径**：使用相对路径或 File API 处理文件访问
4. **浏览器限制**：注意浏览器的文件访问限制和存储限制
5. **用户体验**：确保操作流畅，加载状态明确
6. **移动端适配**：
   - 使用 `safe-area-inset` CSS 变量适配移动端安全区域
   - 优化触摸手势体验（滑动翻页、捏合缩放）
   - 考虑移动端浏览器的性能限制
7. **文件格式兼容性**：确保所有图片格式在主流浏览器上都能正常显示
8. **响应式设计**：确保在移动端和桌面端都有良好的阅读体验

